<!-- Wazuh Server Configuration -->
<ossec_config>
  <!-- Global Settings -->
  <global>
    <jsonout_output>yes</jsonout_output>
    <alerts_log>yes</alerts_log>
    <logall>no</logall>
    <memory_size>8G</memory_size>
  </global>

  <!-- Cluster Configuration -->
  <cluster>
    <name>{{ wazuh_manager_cluster_name }}</name>
    <node_name>{{ wazuh_manager_node_name }}</node_name>
    <node_type>master</node_type>
    <key>c98b79a8b5d49b36b18728a870dda286</key>
    <port>1515</port>
    <bind_addr>0.0.0.0</bind_addr>
    <nodes>
      <node>{{ wazuh_manager_node_name }}</node>
    </nodes>
    <hidden>no</hidden>
    <disabled>no</disabled>
  </cluster>

  <!-- Indexer Integration -->
  <integration>
    <name>wazuh</name>
    <api_url>https://{{ wazuh_indexer_host }}:{{ wazuh_indexer_port }}</api_url>
    <api_username>{{ wazuh_indexer_user }}</api_username>
    <api_password>{{ wazuh_indexer_password }}</api_password>
    <api_verify_ssl>no</api_verify_ssl>
  </integration>

  <!-- Note: Filebeat integration removed. Wazuh Agent handles log collection directly. -->

  <!-- System Check -->
  <syscheck>
    <frequency>{{ wazuh_manager_syscheck_frequency }}</frequency>
    <scan_on_start>yes</scan_on_start>
    <auto_ignore>no</auto_ignore>
    <scan_time>2</scan_time>
  </syscheck>

  <!-- Root Check -->
  <rootcheck>
    <frequency>{{ wazuh_manager_rootcheck_frequency }}</frequency>
    <auto_ignore>no</auto_ignore>
  </rootcheck>

  <!-- Alerts -->
  <alerts>
    <log_alert_level>3</log_alert_level>
    <email_alert>{{ wazuh_manager_email_alert | lower }}</email_alert>
  </alerts>

  <!-- Log Analysis -->
  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/syslog</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/auth.log</location>
  </localfile>

  <localfile>
    <log_format>syslog</log_format>
    <location>/var/log/dpkg.log</location>
  </localfile>
cluster.name: wazuh-indexer-cluster
cluster.routing.allocation.disk.threshold_enabled: false

node.max_local_storage_nodes: "3"
path.data: /var/lib/wazuh-indexer
path.logs: /var/log/wazuh-indexer


plugins.security.ssl.http.pemcert_filepath: /etc/wazuh-indexer/certs/node-1.pem
plugins.security.ssl.http.pemkey_filepath: /etc/wazuh-indexer/certs/node-1-key.pem
plugins.security.ssl.http.pemtrustedcas_filepath: /etc/wazuh-indexer/certs/root-ca.pem
plugins.security.ssl.transport.pemcert_filepath: /etc/wazuh-indexer/certs/node-1.pem
plugins.security.ssl.transport.pemkey_filepath: /etc/wazuh-indexer/certs/node-1-key.pem
plugins.security.ssl.transport.pemtrustedcas_filepath: /etc/wazuh-indexer/certs/root-ca.pem
plugins.security.ssl.http.enabled: true
plugins.security.ssl.transport.enforce_hostname_verification: false
plugins.security.ssl.transport.resolve_hostname: false
plugins.security.ssl.http.enabled_ciphers:
  - "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"
  - "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
  - "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256"
  - "TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384"
plugins.security.ssl.http.enabled_protocols:
  - "TLSv1.2"
plugins.security.authcz.admin_dn:</ossec_config>
