# OpenSearch configuration for Wazuh Indexer
cluster.name: {{ wazuh_indexer_cluster_name | default('wazuh-cluster') }}
node.name: {{ wazuh_indexer_node_name | default('wazuh-indexer-1') }}

# Network settings
network.host: {{ wazuh_indexer_network_host | default('0.0.0.0') }}
http.port: {{ wazuh_indexer_http_port | default(9200) }}
transport.port: {{ wazuh_indexer_transport_port | default(9300) }}

# Security settings
{% if (wazuh_ssl_enabled | default(false)) %}
plugins.security.ssl.http.enabled: true
plugins.security.ssl.transport.enabled: true
plugins.security.ssl.http.pemcert_filepath: {{ wazuh_ssl_cert | default('/etc/wazuh-indexer/certs/wazuh-1.pem') }}
plugins.security.ssl.http.pemkey_filepath: {{ wazuh_ssl_key | default('/etc/wazuh-indexer/certs/wazuh-1-key.pem') }}
plugins.security.ssl.transport.pemcert_filepath: {{ wazuh_ssl_cert | default('/etc/wazuh-indexer/certs/wazuh-1.pem') }}
plugins.security.ssl.transport.pemkey_filepath: {{ wazuh_ssl_key | default('/etc/wazuh-indexer/certs/wazuh-1-key.pem') }}
plugins.security.ssl.transport.pemtrustedcas_filepath: {{ wazuh_ssl_ca | default('/etc/wazuh-indexer/certs/ca.crt') }}
plugins.security.ssl.http.pemtrustedcas_filepath: {{ wazuh_ssl_ca | default('/etc/wazuh-indexer/certs/ca.crt') }}
{% else %}
plugins.security.ssl.http.enabled: false
plugins.security.ssl.transport.enabled: false
{% endif %}

# Performance settings
bootstrap.memory_lock: false
path.data: /var/lib/wazuh-indexer
path.logs: /var/log/wazuh-indexer
path.config: /etc/wazuh-indexer

# Discovery settings
discovery.type: single-node

# Security plugin configuration
plugins.security.allow_unsafe_democertificates: true
plugins.security.allow_default_init_securityindex: true
plugins.security.nodes_dn_dynamic_config_enabled: true
plugins.security.audit.type: internal_opensearch
plugins.security.enable_snapshot_restore_privilege: true
plugins.security.check_snapshot_restore_privilege: true
plugins.security.restapi.roles_enabled: ["all_access", "security_rest_api_access"]
plugins.security.system_indices.enabled: true
plugins.security.system_indices.permissions.enabled: true

# Performance tuning
indices.memory.index_buffer_size: 30%
indices.queries.cache.size: 10%
indices.fielddata.cache.size: 10%
